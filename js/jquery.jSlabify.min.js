/*! jQuery jSlabify plugin v2.5 MIT/GPL2 @gschoppe */
(function(a){a.fn.jSlabify=function(b){var c={targetFont:false,fontZoom:1,constrainHeight:false,slabRatio:1,fixedHeight:false,hCenter:false,vCenter:false,forceNewCharCount:true,wrapAmpersand:true,headerBreakpoint:null,viewportBreakpoint:null,noResizeEvent:false,resizeThrottleTime:300,maxFontSize:999,postTweak:true,minWordSpace:0.4,maxWordSpace:3,maxLetterSpace:1.5,precision:3,minCharsPerLine:2};a("body").addClass("slabified");return this.each(function(){if(b){a.extend(c,b)}var m=a(this),t=a("span.slabbedtext",m).length,h=null,f=null,l=null,K=String(a.trim(m.text())).replace(/\s{2,}/g," ").split(" "),z=[],q=[],B=c.targetFont,d=c.fontZoom,n=c.constrainHeight,D=c.slabRatio,k=c.fixedHeight,A=c.hCenter,F=c.vCenter,L=c.forceNewCharCount,e=c.headerBreakpoint,j=c.viewportBreakpoint,J=c.postTweak,x=c.minWordSpace,p=c.maxWordSpace,v=c.maxLetterSpace,I=c.precision,G=c.resizeThrottleTime,E=c.minCharsPerLine,o=null,s=a(window).width(),g=m.find("a:first").attr("href")||m.attr("href"),i=(g)?m.find("a:first").attr("title"):"";if(!t&&E&&K.join(" ").length<E){return}if(t){var H=document.createElement("div");a(H).html(m.html());var M,u;while(M=H.querySelectorAll("span.slabbedtext")[0]){var r=a(M).text();if(c.wrapAmpersand){r=r.replace(/&/g,'<span class="amp">&amp;</span>')}var C=a(M)[0].previousSibling;C=(C&&C.nodeValue)?C.nodeValue.replace(/\s{2,}/g," ").trim():"";u=a(M)[0].nextSibling;u=(u&&u.nodeValue)?u.nodeValue.replace(/\s{2,}/g," ").trim():"";if(C!=""){z.push({type:0,value:C});q.push(C)}z.push({type:1,value:r});a(M).prevAll().remove();a(M).remove()}if(u!=""){z.push({type:0,value:u});q.push(u)}q=q.join(" ");a(H).remove()}var y=function(){var O=K.join(" "),N=O.length,P=(O.length>0)?O:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-'\".,?!&";divDef='<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:'+m.css("line-height")+';border:0;white-space:nowrap;word-spacing:0;letter-spacing:0;">',dummy=a(divDef+P+"</div>").appendTo(m),emW=dummy.width(),emH=dummy.height(),ratio=(emH==0)?1:emW/emH,charRatio=ratio/P.length;dummy2=a(divDef+"&nbsp;</div>").appendTo(m),f=dummy2.width()/parseFloat(dummy2.css("font-size"),10);dummy.remove();dummy2.remove();return[emW,emH,ratio,P.length,charRatio,f]};var w=function w(){var S=m.width(),O=(k)?m.height():S/D,R,P;if(F){m.height(O)}else{if(!k){m.css("height","auto")}}m.removeClass("slabbedtextdone slabbedtextinactive");if(j&&j>s||e&&e>S){m.addClass("slabbedtextinactive");return}R=y();if(L||P!=h){h=R[1];f=R[5];if(B){var ad=R[4],X=Math.min(60,Math.floor(S/(h*ad*d)));aa=Math.round(R[3]/X)}else{var Y=R[3],ac=R[2],N=S/O,aa=Math.round(Math.sqrt(ac/N)),X=Math.min(60,Math.max(Math.round(Y/aa),1))}function U(ap,ao){var ai=0,am=[],ag=0,ah="",ak="",al="",an,af,aj;l=ap;while(ai<ao.length){ak="";while(ak.length<=l){ah=ak;ak+=ao[ai]+" ";if(++ai>=ao.length){break}}ah=a.trim(ah);ak=a.trim(ak);af=l-ah.length;aj=ak.length-l;if((af<aj)&&(ah.length>=Math.max(E||2))){al=ah;ai--}else{al=ak}remainingText=ao.slice(ai).join(" ");if(remainingText.length>0&&remainingText.length<l){newLineDiff=Math.max(((l-remainingText.length),Math.abs(al.length-l)));oneLineDiff=Math.abs(al.length+remainingText.length+1-l);if(oneLineDiff<newLineDiff||remainingText.length<Math.max(E,3)){al+=" "+remainingText;ai=ao.length}}al=a("<div/>").text(al).html();if(c.wrapAmpersand){al=al.replace(/&amp;/g,'<span class="amp">&amp;</span>')}al=a.trim(al);am.push('<span class="slabbedtext">'+al+"</span>")}return am}if(!t){m.html(U(X,K).join(""))}else{aa=Math.max(aa,z.length);var Z=aa-t;var T=[];for(var ab=0;ab<z.length;ab++){if(z[ab].type){T.push('<span class="slabbedtext">'+z[ab].value+"</span>")}else{var Q=String(a.trim(z[ab].value));charPerLine=Q.length/Math.max(Math.round(Z*Q.length/q.length),1);sectionWords=Q.replace(/\s{2,}/g," ").split(" ");T=T.concat(U(charPerLine,sectionWords))}}m.html(T.join(""))}if(g){m.wrapInner('<a href="'+g+'" '+(i?'title="'+i+'" ':"")+"/>")}}else{h=R[1]}if(!(m.has("div.innerslabwrap").length>0)){m.wrapInner('<div class="innerslabwrap" />')}var W=m.children("div.innerslabwrap");W.css("font-size",1+"em");a("span.slabbedtext",m).each(function(){var af=a(this),ak=af.text(),ah=ak.split(" ").length>1,aj=parseFloat(af.css("font-size"),10),ai,ag;if(J){if(ah){af.css({"word-spacing":""+aj*f*x-f*aj+"px","letter-spacing":0});var al=ak.split(" ").length-1;if(al<0){al=0}}else{af.css("letter-spacing",0)}}af.css("font-size",1+"em");ai=(af.width()>0)?S/af.width():1;ag=(Math.min((h*ai),c.maxFontSize)/h).toFixed(I);af.css("font-size",ag+"em")});var ae=1;if(n&&(W.height()>O)){ae=(O/W.height()).toFixed(I);W.css("font-size",ae+"em")}if(J){a("span.slabbedtext",m).each(function(){var af=a(this),ai=af.text(),ag=ai.split(" ").length,aj=S-af.width(),ah=parseFloat(af.css("font-size"),10);if(ag>1){var ak=aj/(ag-1);if(ak<ah*f*x){ak=ah*f*x}else{if(ak>ah*f*p){ak=ah*f*p}}ak=ak-ah*f;af.css("word-spacing",ak.toFixed(I)+"px");aj=S-af.width()}var ak=aj/ai.length;if(ak<0){ak=0}else{if(ak>ah*f*v){ak=ah*f*v}}af.css("letter-spacing",ak.toFixed(I)+"px");if((S-af.width())/S>0.1){af.css("letter-spacing",0);af.css("word-spacing",0)}})}m.addClass("slabbedtextdone");if(A){W.css("text-align","center")}if(n&&F){var V=((O-W.height())/2).toFixed(I);W.css("position","relative").css("top",V+"px")}};w();if(!c.noResizeEvent){a(window).resize(function(){if(a(window).width()==s){return}s=a(window).width();clearTimeout(o);o=setTimeout(w,G)})}})}})(jQuery);