/*! jQuery jSlabify plugin v2.0 MIT/GPL2 @gschoppe */
(function(a){a.fn.jSlabify=function(b){var c={targetFont:false,fontZoom:1,constrainHeight:false,slabRatio:1,fixedHeight:false,hCenter:false,vCenter:false,forceNewCharCount:true,wrapAmpersand:true,headerBreakpoint:null,viewportBreakpoint:null,noResizeEvent:false,resizeThrottleTime:300,maxFontSize:999,postTweak:true,minWordSpace:3,precision:3,minCharsPerLine:0};a("body").addClass("slabified");return this.each(function(){if(b){a.extend(c,b)}var q=a(this),D=a("span.slabbedtext",q).length,e=null,u=null,B=String(a.trim(q.text())).replace(/\s{2,}/g," ").split(" "),A=[],s=[],f=c.targetFont,z=c.fontZoom,g=c.constrainHeight,x=c.slabRatio,I=c.fixedHeight,j=c.hCenter,n=c.vCenter,m=c.forceNewCharCount,k=c.headerBreakpoint,C=c.viewportBreakpoint,p=c.postTweak,i=c.minWordSpace,H=c.precision,G=c.resizeThrottleTime,t=c.minCharsPerLine,r=null,E=a(window).width(),w=q.find("a:first").attr("href")||q.attr("href"),h=w?q.find("a:first").attr("title"):"";if(!D&&t&&B.join(" ").length<t){return}if(D){var y=document.createElement("div");a(y).html(q.html());var J,v;while(J=y.querySelectorAll("span.slabbedtext")[0]){var o=a(J).text();var d=a(J)[0].previousSibling;d=(d&&d.nodeValue)?d.nodeValue.replace(/\s{2,}/g," ").trim():"";v=a(J)[0].nextSibling;v=(v&&v.nodeValue)?v.nodeValue.replace(/\s{2,}/g," ").trim():"";if(d!=""){A.push({type:0,value:d});s.push(d)}A.push({type:1,value:o});a(J).prevAll().remove();a(J).remove()}if(v!=""){A.push({type:0,value:v});s.push(v)}s=s.join(" ");a(y).remove()}var F=function(){var L=B.join(" "),K=L.length,M=(L.length>0)?L:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-'.,?!&";dummy=jQuery('<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;white-space:nowrap;">'+M+"</div>").appendTo(q),emW=dummy.width(),emH=dummy.height(),ratio=(emH==0)?1:emW/emH,charRatio=ratio/M.length;dummy.remove();return[emW,emH,ratio,M.length,charRatio]};var l=function l(){var P=q.width(),L=(I)?q.height():P/x,O,M;if(n){q.height(L)}else{if(!I){q.css("height","auto")}}q.removeClass("slabbedtextdone slabbedtextinactive");if(C&&C>E||k&&k>P){q.addClass("slabbedtextinactive");return}O=F();if(m||M!=e){e=O[1];if(f){var aa=O[4],U=Math.min(60,Math.floor(P/(e*aa*z)));X=Math.round(O[3]/U)}else{var V=O[3],Z=O[2],K=P/L,X=Math.round(Math.sqrt(Z/K)),U=Math.min(60,Math.max(Math.round(V/X),1))}function R(am,al){var af=0,aj=[],ad=0,ae="",ah="",ai="",ak,ac,ag;u=am;while(af<al.length){ah="";while(ah.length<u){ae=ah;ah+=al[af]+" ";if(++af>=al.length){break}}if(t){ak=al.slice(af).join(" ");if(ak.length<t){ah+=ak;ae=ah;af=al.length+2}}ac=u-ae.length;ag=ah.length-u;if((ac<ag)&&(ae.length>=(t||2))){ai=ae;af--}else{ai=ah}ai=a("<div/>").text(ai).html();if(c.wrapAmpersand){ai=ai.replace(/&amp;/g,'<span class="amp">&amp;</span>')}ai=a.trim(ai);aj.push('<span class="slabbedtext">'+ai+"</span>")}return aj}if(!D){q.html(R(U,B).join(""))}else{X=Math.max(X,A.length);var W=X-D;var Q=[];for(var Y=0;Y<A.length;Y++){if(A[Y].type){Q.push('<span class="slabbedtext">'+A[Y].value+"</span>")}else{var N=String(a.trim(A[Y].value));charPerLine=N.length/Math.max(Math.round(W*N.length/s.length),1);sectionWords=N.replace(/\s{2,}/g," ").split(" ");Q=Q.concat(R(charPerLine,sectionWords))}}q.html(Q.join(""))}if(w){q.wrapInner('<a href="'+w+'" '+(h?'title="'+h+'" ':"")+"/>")}}else{e=O[1]}if(!(q.has("div.innerslabwrap").length>0)){q.wrapInner('<div class="innerslabwrap" />')}var T=q.children("div.innerslabwrap");T.css("font-size",1+"em");a("span.slabbedtext",q).each(function(){var ai=a(this),af=ai.text(),ac=af.split(" ").length>1,aj,ag,ae;var ak=0;if(p){ai.css({"word-spacing":0,"letter-spacing":0});var ad=af.split(" ").length-1;if(ad<0){ad=0}ak=ad*i}ai.css("font-size",1+"em");ag=P/(ai.width()+ak);ae=(Math.min((e*ag),c.maxFontSize)/e).toFixed(H);ai.css("font-size",ae+"em");aj=P-ai.width();if(aj<0){aj=0}if(p&&aj){if(ac){var ah=(aj/(af.split(" ").length-1)).toFixed(H);if(ah<0){ah=0}ai.css("word-spacing",ah+"px")}else{var ah=(aj/af.length).toFixed(H);if(ah<0){ah=0}ai.css("letter-spacing",ah+"px")}}});var ab=1;if(g&&(T.height()>L)){ab=(L/T.height()).toFixed(H);T.css("font-size",ab+"em")}q.addClass("slabbedtextdone");if(j){T.css("text-align","center")}if(g&&n){var S=((L-T.height())/2).toFixed(H);T.css("position","relative").css("top",S+"px")}};l();if(!c.noResizeEvent){a(window).resize(function(){if(a(window).width()==E){return}E=a(window).width();clearTimeout(r);r=setTimeout(l,G)})}})}})(jQuery);