/*! jQuery jSlabify plugin v1.0 MIT/GPL2 @gschoppe */
(function(e){e.fn.jSlabify=function(t){var n={targetFont:false,fontZoom:1,constrainHeight:false,boxRatio:1,fixedHeight:false,borderBox:false,forceNewCharCount:true,wrapAmpersand:true,headerBreakpoint:null,viewportBreakpoint:null,noResizeEvent:false,resizeThrottleTime:300,maxFontSize:999,postTweak:true,precision:3,minCharsPerLine:0};e("body").addClass("slabtexted");return this.each(function(){if(t)e.extend(n,t);var r=e(this),i=e("span.slabtext",r).length,s=i?[]:String(e.trim(r.text())).replace(/\s{2,}/g," ").split(" "),o=null,u=null,a=n.targetFont,f=n.fontZoom,l=n.constrainHeight,c=n.boxRatio,h=n.fixedHeight,p=n.borderBox,d=n.forceNewCharCount,v=n.headerBreakpoint,m=n.viewportBreakpoint,g=n.postTweak,y=n.precision,b=n.resizeThrottleTime,w=n.minCharsPerLine,E=null,S=e(window).width(),x=r.find("a:first").attr("href")||r.attr("href"),T=x?r.find("a:first").attr("title"):"";if(!i&&w&&s.join(" ").length<w)return;var N=function(){var e=s.join(" "),t=e.length,n=e.length>0?e:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-'.,?!&";dummy=jQuery('<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;white-space:nowrap;">'+n+"</div>").appendTo(r),emW=dummy.width(),emH=dummy.height(),ratio=emH==0?1:emW/emH,charRatio=ratio/n.length;dummy.remove();return[emW,emH,ratio,n.length,charRatio]};var C=function(){if(l&&p)r.css("padding",0+"px");var c=r.width(),b=h?r.height():c/M,E,C;r.removeClass("slabtextdone slabtextinactive");if(m&&m>S||v&&v>c){r.addClass("slabtextinactive");return}E=N();if(!i&&(d||C!=o)){o=E[1];if(a){var k=E[4],L=Math.min(60,Math.floor(c/(o*k*f)))}else{var A=E[3],O=E[2],M=c/b,_=Math.round(Math.sqrt(O/M)),L=Math.min(60,Math.max(Math.round(A/_),1))}var D=0,P=[],H=0,B="",j="",F="",I,q,R;if(L!=u){u=L;while(D<s.length){j="";while(j.length<u){B=j;j+=s[D]+" ";if(++D>=s.length){break}}if(w){I=s.slice(D).join(" ");if(I.length<w){j+=I;B=j;D=s.length+2}}q=u-B.length;R=j.length-u;if(q<R&&B.length>=(w||2)){F=B;D--}else{F=j}F=e("<div/>").text(F).html();if(n.wrapAmpersand)F=F.replace(/&/g,'<span class="amp">&</span>');F=e.trim(F);P.push('<span class="slabtext">'+F+"</span>")}r.html(P.join(" "));if(x)r.wrapInner('<a href="'+x+'" '+(T?'title="'+T+'" ':"")+"/>")}}else{o=E[1]}var U=0;r.css("font-size",1+"em");e("span.slabtext",r).each(function(){var t=e(this),r=t.text(),i=r.split(" ").length>1,s,u,a;if(g)t.css({"word-spacing":0,"letter-spacing":0});t.css("font-size",1+"em");u=c/t.width();a=(Math.min(o*u,n.maxFontSize)/o).toFixed(y);t.css("font-size",a+"em");U+=t.height();s=!!g?c-t.width():false;if(s)t.css((i?"word":"letter")+"-spacing",(s/(i?r.split(" ").length-1:r.length)).toFixed(y)+"px")});var z=1;if(l&&U>b){z=(b/U).toFixed(y);r.css("font-size",z+"em")}if(l&&p)r.css("padding",((b-U*z)/2).toFixed(y)+"px 0");r.addClass("slabtextdone")};C();if(!n.noResizeEvent){e(window).resize(function(){if(e(window).width()==S)return;S=e(window).width();clearTimeout(E);E=setTimeout(C,b)})}})}})(jQuery)