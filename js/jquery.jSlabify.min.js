/*! jQuery jSlabify plugin v1.2 MIT/GPL2 @gschoppe */
(function(a){a.fn.jSlabify=function(b){var c={targetFont:false,fontZoom:1,groupStr:"&nbsp;",constrainHeight:false,slabRatio:1,fixedHeight:false,hCenter:false,vCenter:false,forceNewCharCount:true,wrapAmpersand:true,headerBreakpoint:null,viewportBreakpoint:null,noResizeEvent:false,resizeThrottleTime:300,maxFontSize:999,postTweak:true,minWordSpace:3,precision:3,minCharsPerLine:0};a("body").addClass("slabified");return this.each(function(){if(b){a.extend(c,b)}var o=a(this),y=a("span.slabbedtext",o).length,d=null,r=null,E="\u00A0",t=(c.groupStr)?new RegExp(c.groupStr.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"g"):null,w=y?[]:String(a.trim(o.text())).replace(/\s{2,}/g," ").replace(t,E).split(" "),e=c.targetFont,v=c.fontZoom,f=c.constrainHeight,u=c.slabRatio,D=c.fixedHeight,i=c.hCenter,m=c.vCenter,l=c.forceNewCharCount,j=c.headerBreakpoint,x=c.viewportBreakpoint,n=c.postTweak,h=c.minWordSpace,C=c.precision,B=c.resizeThrottleTime,q=c.minCharsPerLine,p=null,z=a(window).width(),s=o.find("a:first").attr("href")||o.attr("href"),g=s?o.find("a:first").attr("title"):"";if(!y&&q&&w.join(" ").length<q){return}var A=function(){var G=w.join(" "),F=G.length,H=(G.length>0)?G:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-'.,?!&";dummy=jQuery('<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;white-space:nowrap;">'+H+"</div>").appendTo(o),emW=dummy.width(),emH=dummy.height(),ratio=(emH==0)?1:emW/emH,charRatio=ratio/H.length;dummy.remove();return[emW,emH,ratio,H.length,charRatio]};var k=function k(){var L=o.width(),G=(D)?o.height():L/u,J,I;if(m){o.height(G)}else{if(!D){o.css("height","auto")}}o.removeClass("slabbedtextdone slabbedtextinactive");if(x&&x>z||j&&j>L){o.addClass("slabbedtextinactive");return}J=A();if(!y&&(l||I!=d)){d=J[1];if(e){var Z=J[4],O=Math.min(60,Math.floor(L/(d*Z*v)))}else{var Q=J[3],W=J[2],F=L/G,S=Math.round(Math.sqrt(W/F)),O=Math.min(60,Math.max(Math.round(Q/S),1))}var P=0,H=[],K=0,Y="",V="",R="",T,X,U;if(O!=r){r=O;while(P<w.length){V="";while(V.length<r){Y=V;V+=w[P]+" ";if(++P>=w.length){break}}if(q){T=w.slice(P).join(" ");if(T.length<q){V+=T;Y=V;P=w.length+2}}X=r-Y.length;U=V.length-r;if((X<U)&&(Y.length>=(q||2))){R=Y;P--}else{R=V}R=a("<div/>").text(R).html();if(c.wrapAmpersand){R=R.replace(/&amp;/g,'<span class="amp">&amp;</span>')}R=a.trim(R);H.push('<span class="slabbedtext">'+R+"</span>")}o.html(H.join(" "));if(s){o.wrapInner('<a href="'+s+'" '+(g?'title="'+g+'" ':"")+"/>")}}}else{d=J[1]}if(!(o.has("div.innerslabwrap").length>0)){o.wrapInner('<div class="innerslabwrap" />')}var N=o.children("div.innerslabwrap");N.css("font-size",1+"em");a("span.slabbedtext",o).each(function(){var ah=a(this),ae=ah.text(),ab=ae.split(" ").length>1,ai,af,ad;var aj=0;if(n){ah.css({"word-spacing":0,"letter-spacing":0});var ac=ae.split(" ").length-1;if(ac<0){ac=0}aj=ac*h}ah.css("font-size",1+"em");af=L/(ah.width()+aj);ad=(Math.min((d*af),c.maxFontSize)/d).toFixed(C);ah.css("font-size",ad+"em");ai=L-ah.width();if(ai<0){ai=0}if(n&&ai){if(ab){var ag=(ai/(ae.split(" ").length-1)).toFixed(C);if(ag<0){ag=0}ah.css("word-spacing",ag+"px")}else{var ag=(ai/ae.length).toFixed(C);if(ag<0){ag=0}ah.css("letter-spacing",ag+"px")}}});var aa=1;if(f&&(N.height()>G)){aa=(G/N.height()).toFixed(C);N.css("font-size",aa+"em")}o.addClass("slabbedtextdone");if(i){N.css("text-align","center")}if(f&&m){var M=((G-N.height())/2).toFixed(C);N.css("position","relative").css("top",M+"px")}};k();if(!c.noResizeEvent){a(window).resize(function(){if(a(window).width()==z){return}z=a(window).width();clearTimeout(p);p=setTimeout(k,B)})}})}})(jQuery);