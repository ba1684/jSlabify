/*! jQuery jSlabify plugin v1.0 MIT/GPL2 @gschoppe */
(function(a){a.fn.jSlabify=function(b){var c={targetFont:false,fontZoom:1,constrainHeight:false,slabRatio:1,fixedHeight:false,hCenter:false,vCenter:false,forceNewCharCount:true,wrapAmpersand:true,headerBreakpoint:null,viewportBreakpoint:null,noResizeEvent:false,resizeThrottleTime:300,maxFontSize:999,postTweak:true,minWordSpace:3,precision:3,minCharsPerLine:0};a("body").addClass("slabified");return this.each(function(){if(b){a.extend(c,b)}var n=a(this),x=a("span.slabbedtext",n).length,v=x?[]:String(a.trim(n.text())).replace(/\s{2,}/g," ").split(" "),d=null,r=null,e=c.targetFont,u=c.fontZoom,f=c.constrainHeight,t=c.slabRatio,C=c.fixedHeight,h=c.hCenter,m=c.vCenter,l=c.forceNewCharCount,i=c.headerBreakpoint,w=c.viewportBreakpoint,o=c.postTweak,j=c.minWordSpace,B=c.precision,A=c.resizeThrottleTime,q=c.minCharsPerLine,p=null,y=a(window).width(),s=n.find("a:first").attr("href")||n.attr("href"),g=s?n.find("a:first").attr("title"):"";if(!x&&q&&v.join(" ").length<q){return}var z=function(){var E=v.join(" "),D=E.length,F=(E.length>0)?E:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-'.,?!&";dummy=jQuery('<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;white-space:nowrap;">'+F+"</div>").appendTo(n),emW=dummy.width(),emH=dummy.height(),ratio=(emH==0)?1:emW/emH,charRatio=ratio/F.length;dummy.remove();return[emW,emH,ratio,F.length,charRatio]};var k=function k(){var J=n.width(),E=(C)?n.height():J/t,H,G;n.removeClass("slabbedtextdone slabbedtextinactive");if(w&&w>y||i&&i>J){n.addClass("slabbedtextinactive");return}H=z();if(!x&&(l||G!=d)){d=H[1];if(e){var X=H[4],M=Math.min(60,Math.floor(J/(d*X*u)))}else{var O=H[3],U=H[2],D=J/E,Q=Math.round(Math.sqrt(U/D)),M=Math.min(60,Math.max(Math.round(O/Q),1))}var N=0,F=[],I=0,W="",T="",P="",R,V,S;if(M!=r){r=M;while(N<v.length){T="";while(T.length<r){W=T;T+=v[N]+" ";if(++N>=v.length){break}}if(q){R=v.slice(N).join(" ");if(R.length<q){T+=R;W=T;N=v.length+2}}V=r-W.length;S=T.length-r;if((V<S)&&(W.length>=(q||2))){P=W;N--}else{P=T}P=a("<div/>").text(P).html();if(c.wrapAmpersand){P=P.replace(/&amp;/g,'<span class="amp">&amp;</span>')}P=a.trim(P);F.push('<span class="slabbedtext">'+P+"</span>")}n.html(F.join(" "));if(s){n.wrapInner('<a href="'+s+'" '+(g?'title="'+g+'" ':"")+"/>")}}}else{d=H[1]}if(!(n.has("div.innerslabwrap").length>0)){n.wrapInner('<div class="innerslabwrap" />')}var L=n.children("div.innerslabwrap");L.css("font-size",1+"em");a("span.slabbedtext",n).each(function(){var af=a(this),ac=af.text(),Z=ac.split(" ").length>1,ag,ad,ab;var ah=0;if(o){af.css({"word-spacing":0,"letter-spacing":0});var aa=ac.split(" ").length-1;if(aa<0){aa=0}ah=aa*j}af.css("font-size",1+"em");ad=J/(af.width()+ah);ab=(Math.min((d*ad),c.maxFontSize)/d).toFixed(B);af.css("font-size",ab+"em");ag=J-af.width();if(ag<0){ag=0}if(o&&ag){if(Z){var ae=(ag/(ac.split(" ").length-1)).toFixed(B);if(ae<0){ae=0}af.css("word-spacing",ae+"px")}else{var ae=(ag/ac.length).toFixed(B);if(ae<0){ae=0}af.css("letter-spacing",ae+"px")}}});var Y=1;if(f&&(L.height()>E)){Y=(E/L.height()).toFixed(B);L.css("font-size",Y+"em")}n.addClass("slabbedtextdone");if(h){L.css("text-align","center")}if(f&&m){var K=((E-L.height())/2).toFixed(B);L.css("position","relative").css("top",K+"px")}};k();if(!c.noResizeEvent){a(window).resize(function(){if(a(window).width()==y){return}y=a(window).width();clearTimeout(p);p=setTimeout(k,A)})}})}})(jQuery);